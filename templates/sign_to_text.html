<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Sign to Text</title>
    <style>
        body { 
            font-family: 'Segoe UI', sans-serif; 
            background: linear-gradient(135deg, #0d1b2a, #1b263b); 
            margin: 0; 
            padding: 0; 
            display: flex; 
            height: 100vh; 
            color: #e0e1dd;
        }
        .left, .right { 
            width: 50%; 
            padding: 20px; 
            box-sizing: border-box; 
        }
        .left { 
            background: #d5d7da; 
            border-right: 2px solid #1e2a39; 
            display: flex; 
            flex-direction: column; 
            align-items: center; 
        }
        .camera-box { 
            border: 3px solid #242d39; 
            border-radius: 12px; 
            overflow: hidden; 
            width: 480px; 
            height: 360px; 
            margin-bottom: 15px; 
        }
        .detected-text { 
            font-size: 22px; 
            font-weight: bold; 
            color: #052132; 
            margin: 10px 0; 
        }
        .btn { 
            background: #415a77; 
            color: white; 
            border: none; 
            padding: 10px 20px; 
            margin: 5px; 
            border-radius: 8px; 
            cursor: pointer; 
            transition: 0.3s; 
        }
        .btn:hover { 
            background: #778da9; 
        }
        .dropdown { 
            margin: 15px 0; 
        }
        select { 
            padding: 10px 15px; 
            border: 2px solid #415a77; 
            border-radius: 8px; 
            background: #0d1b2a; 
            color: #e0e1dd; 
            font-size: 16px; 
            font-weight: 500; 
            cursor: pointer; 
            outline: none; 
            transition: 0.3s; 
        }
        select:hover { 
            background: #1b263b; 
        }
        .right { 
            background: #a0a7ae; 
            display: flex; 
            flex-direction: column; 
            align-items: center; 
        }
        h2 { 
            color: #ffffff; 
        }
        ul { 
            list-style: none; 
            padding: 0; 
            margin: 0; 
            width: 100%; 
            max-width: 400px; 
        }
        li { 
            background: #415a77; 
            color: white; 
            padding: 10px; 
            margin: 5px 0; 
            border-radius: 8px; 
            text-align: center; 
        }
    </style>
</head>
<body>
    <div class="left">
        <div class="camera-box">
            <img src="{{ url_for('video_feed') }}" width="100%" height="100%">
        </div>
        <div class="detected-text" id="detected-text">Waiting for detection...</div>

        <div class="dropdown">
            <select id="language" onchange="changeLanguage()">
                <option value="en" {% if lang == 'en' %}selected{% endif %}>English</option>
                <option value="hi" {% if lang == 'hi' %}selected{% endif %}>Hindi</option>
                <option value="mr" {% if lang == 'mr' %}selected{% endif %}>Marathi</option>
            </select>
        </div>

        <button class="btn" onclick="startDetection()">Start Detection</button>
        <button class="btn" onclick="closeCamera()">Close Camera</button>
        <button class="btn" onclick="clearHistory()">Clear History</button>
    </div>

    <div class="right">
        <h2>Detection History</h2>
        <ul id="history"></ul>
    </div>

    <script>
        function updateContent() {
            fetch(`/get_sign`)
                .then(res => res.text())
                .then(data => {
                    if(data) document.getElementById("detected-text").innerText = data;
                });

            fetch(`/get_history`)
                .then(res => res.json())
                .then(history => {
                    const historyList = document.getElementById("history");
                    historyList.innerHTML = "";
                    history.translated.forEach(item => {
                        let li = document.createElement("li");
                        li.innerText = item;
                        historyList.appendChild(li);
                    });
                });
        }

        function startDetection() {
            fetch("/start_detection", { method: "POST" })
                .then(res => res.json())
                .then(data => {
                    if(data.status === "started") {
                        document.getElementById("detected-text").innerText = "Detecting sign...";
                    }
                });
        }

        function clearHistory() {
            fetch("/clear_history", { method: "POST" }).then(() => {
                document.getElementById("history").innerHTML = "";
                document.getElementById("detected-text").innerText = "Waiting for detection...";
            });
        }

        function closeCamera() {
            window.location.href = "/close_camera";
        }

        function changeLanguage() {
            const lang = document.getElementById("language").value;
            window.location.href = `/sign_to_text/${lang}`;
        }

        setInterval(updateContent, 500);
    </script>
</body>
</html>